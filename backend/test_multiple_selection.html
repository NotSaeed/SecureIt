<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Multiple Selection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .selection-mode-tabs { display: flex; gap: 10px; margin: 10px 0; }
        .mode-tab { padding: 10px; border: 1px solid #ddd; cursor: pointer; }
        .mode-tab.active { background: #007cba; color: white; }
        .selection-section { margin: 20px 0; padding: 20px; border: 1px solid #eee; }
        .item-checkbox { display: flex; align-items: center; padding: 10px; margin: 5px 0; border: 1px solid #ddd; }
        .item-checkbox.selected { background: #e6f3ff; }
        .selection-controls { margin: 10px 0; }
        .btn-small { padding: 5px 10px; margin: 5px; cursor: pointer; }
        .selection-count { background: #007cba; color: white; padding: 5px 10px; border-radius: 15px; }
    </style>
</head>
<body>
    <h1>Multiple Selection Test</h1>
    
    <div class="section">
        <h3>Selection Mode</h3>
        <div class="selection-mode-tabs">
            <input type="radio" id="single_item" name="selection_mode" value="single" checked>
            <label for="single_item" class="mode-tab">Single Item</label>
            <input type="radio" id="multiple_items" name="selection_mode" value="multiple">
            <label for="multiple_items" class="mode-tab">Multiple Items</label>
            <input type="radio" id="all_items" name="selection_mode" value="all">
            <label for="all_items" class="mode-tab">All Items</label>
        </div>
        
        <!-- Single Item Selection -->
        <div id="single_selection" class="selection-section">
            <h4>Single Selection</h4>
            <select id="vault_item_id" name="vault_item_id">
                <option value="">Select a vault item...</option>
                <option value="1">üîê Test Login</option>
                <option value="2">üí≥ Test Card</option>
                <option value="3">üìù Test Note</option>
            </select>
        </div>

        <!-- Multiple Items Selection -->
        <div id="multiple_selection" class="selection-section" style="display: none;">
            <h4>Multiple Selection</h4>
            <div class="selection-controls">
                <button type="button" onclick="selectAllItems()" class="btn-small">Select All</button>
                <button type="button" onclick="clearAllItems()" class="btn-small">Clear All</button>
            </div>
            
            <div class="items-checklist">
                <div class="item-checkbox">
                    <input type="checkbox" id="item_1" name="vault_items[]" value="1">
                    <label for="item_1">üîê Test Login</label>
                </div>
                <div class="item-checkbox">
                    <input type="checkbox" id="item_2" name="vault_items[]" value="2">
                    <label for="item_2">üí≥ Test Card</label>
                </div>
                <div class="item-checkbox">
                    <input type="checkbox" id="item_3" name="vault_items[]" value="3">
                    <label for="item_3">üìù Test Note</label>
                </div>
            </div>
        </div>

        <!-- All Items Selection -->
        <div id="all_selection" class="selection-section" style="display: none;">
            <h4>All Items Selection</h4>
            <div class="info-box">
                <strong>Share All Vault Items</strong>
                <p>This will share all items in your vault. Total items: 3</p>
            </div>
        </div>
    </div>

    <script>
        function handleSelectionModeChange() {
            const selectedMode = document.querySelector('input[name="selection_mode"]:checked')?.value || 'single';
            
            console.log('Selection mode changed to:', selectedMode);
            
            // Hide all selection sections
            document.getElementById('single_selection').style.display = 'none';
            document.getElementById('multiple_selection').style.display = 'none';
            document.getElementById('all_selection').style.display = 'none';
            
            // Show the selected section
            switch (selectedMode) {
                case 'single':
                    document.getElementById('single_selection').style.display = 'block';
                    break;
                case 'multiple':
                    document.getElementById('multiple_selection').style.display = 'block';
                    break;
                case 'all':
                    document.getElementById('all_selection').style.display = 'block';
                    break;
            }
        }
        
        function handleCheckboxChange() {
            const checkedBoxes = document.querySelectorAll('input[name="vault_items[]"]:checked');
            console.log('Checkboxes changed, checked count:', checkedBoxes.length);
            
            // Visual feedback
            const allCheckboxes = document.querySelectorAll('input[name="vault_items[]"]');
            allCheckboxes.forEach(checkbox => {
                const itemBox = checkbox.closest('.item-checkbox');
                if (checkbox.checked) {
                    itemBox.classList.add('selected');
                } else {
                    itemBox.classList.remove('selected');
                }
            });
            
            updateMultipleSelectionCount(checkedBoxes.length);
        }
        
        function updateMultipleSelectionCount(count) {
            let countDisplay = document.getElementById('selection-count');
            if (!countDisplay) {
                countDisplay = document.createElement('div');
                countDisplay.id = 'selection-count';
                countDisplay.className = 'selection-count';
                document.getElementById('multiple_selection').appendChild(countDisplay);
            }
            
            if (count > 0) {
                countDisplay.innerHTML = `${count} item${count !== 1 ? 's' : ''} selected`;
                countDisplay.style.display = 'block';
            } else {
                countDisplay.style.display = 'none';
            }
        }
        
        function selectAllItems() {
            const checkboxes = document.querySelectorAll('input[name="vault_items[]"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                checkbox.closest('.item-checkbox').classList.add('selected');
            });
            updateMultipleSelectionCount(checkboxes.length);
        }
        
        function clearAllItems() {
            const checkboxes = document.querySelectorAll('input[name="vault_items[]"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.item-checkbox').classList.remove('selected');
            });
            updateMultipleSelectionCount(0);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const selectionModeRadios = document.querySelectorAll('input[name="selection_mode"]');
            selectionModeRadios.forEach(radio => {
                radio.addEventListener('change', handleSelectionModeChange);
            });
            
            const multipleCheckboxes = document.querySelectorAll('input[name="vault_items[]"]');
            multipleCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });
            
            handleSelectionModeChange();
        });
    </script>
</body>
</html>
